# ============================================================================
# LONG DURATION ROM-MVAR WITH d=40
# ============================================================================
# Testing longer trajectories with slightly larger POD dimension
#
# CONFIGURATION:
#   - Training: 400 runs × T=20s
#   - ROM time step: Δt_ROM = 0.25s (subsample every 5 frames from dt=0.05)
#   - POD dimension: d = 40 (fixed, hard cap)
#   - MVAR lag: w = 20
#   - MVAR params: 40² × 20 = 32,000
#   - ROM samples: 400 × (20 / 0.25) = 400 × 80 = 32,000
#   - Ratio params/data ≈ 32000/32000 = 1.0 (balanced)
#
# IMPROVEMENTS OVER parameter_regime_change:
#   - Longer trajectories (20s vs 5s) for better temporal dynamics
#   - Larger POD (d=40 vs d=25) for richer latent space
#   - Same MVAR lag (w=20) - proven effective
#   - Balanced params/data ratio
# ============================================================================

# Model
model:
  type: discrete
  speed: 2.0
  speed_mode: constant_with_forces

# Simulation parameters
sim:
  N: 150
  Lx: 15.0
  Ly: 15.0
  bc: "periodic"
  T: 20.0                   # 20 seconds - 4x longer than before
  dt: 0.05                  # Micro timestep: 0.05s
  save_every: 1
  neighbor_rebuild: 5
  integrator: "euler"

# Vicsek alignment
params:
  R: 3.0
  alpha: 1.5
  beta: 0.5

# Noise
noise:
  kind: "gaussian"
  eta: 0.2

# Morse forces
forces:
  enabled: true
  type: "morse"
  params:
    Cr: 0.3
    Ca: 1.0
    lr: 0.5
    la: 2.0
    rcut_factor: 3.0
    mu_t: 0.3

alignment:
  enabled: true

# Outputs
outputs:
  run_name: "long_duration_d40"
  order_parameters: true
  save_npz: true
  fps: 20
  density_resolution: 64
  density_bandwidth: 2.0

# ============================================================================
# TRAINING: Mixed distributions (400 runs)
# ============================================================================
train_ic:
  type: "mixed_comprehensive"
  
  # Gaussian cluster distributions (200 runs = 50%)
  gaussian:
    enabled: true
    n_runs: 200
    positions_x: [3.75, 7.5, 11.25, 15.0, 18.75]
    positions_y: [3.75, 7.5, 11.25, 15.0, 18.75]
    variances: [0.5, 1.0, 2.0, 3.0]
    n_samples_per_config: 2
  
  # Ring distributions (50 runs = 12.5%)
  ring:
    enabled: true
    n_runs: 50
    radii: [3.0, 4.0, 5.0, 6.0, 7.0]
    n_samples_per_radius: 10
  
  # Two clusters (50 runs = 12.5%)
  two_clusters:
    enabled: true
    n_runs: 50
    separations: [5.0, 7.0, 9.0, 11.0, 13.0]
    variances: [1.0, 2.0]
    n_samples_per_config: 5
  
  # Uniform distributions (100 runs = 25%)
  uniform:
    enabled: true
    n_runs: 100
    n_samples: 100

# ============================================================================
# TEST: Stratified by IC type (40 runs)
# ============================================================================
test_ic:
  type: "stratified"
  total_runs: 40
  
  ic_types:
    - type: "gaussian_cluster"
      n_runs: 10
      center: [7.5, 7.5]
      sigma_range: [1.0, 3.0]
    
    - type: "ring"
      n_runs: 10
      radius_range: [3.0, 7.0]
      thickness: 0.5
    
    - type: "two_clusters"
      n_runs: 10
      separation_range: [6.0, 12.0]
      sigma: 1.5
    
    - type: "uniform"
      n_runs: 10

# Density estimation
density:
  enabled: true
  nx: 64
  ny: 64
  method: "kde"
  bandwidth: 2.0

# ============================================================================
# ROM-MVAR CONFIGURATION
# ============================================================================

# ROM temporal subsampling
rom_subsample: 5            # Subsample by 5 → Δt_ROM = 0.25s

# POD parameters
pod_target_energy: 0.995    # Will be overridden by fixed_d
fixed_d: 40                 # FIXED: Use exactly 40 modes

# MVAR parameters
mvar_lag: 20                # Lag order w=20
ridge_alpha: 0.05           # Ridge regularization

# Companion matrix stabilization (Alvarez Step 5)
eigenvalue_threshold: 0.98  # Scale spectral radius to ≤0.98
