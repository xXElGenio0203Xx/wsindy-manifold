# ROM Pipeline Test Configuration
#
# This configuration is optimized for quick local testing of the full ROM pipeline.
# For production runs on Oscar, use larger N, T, n_runs, and higher resolution.
#
# Usage:
#   rectsim ensemble --config configs/rom_test.yaml
#   python scripts/rom_build_pod.py --experiment_name rom_test --sim_root simulations/.../runs --train_runs 0 1 2 3 4 5 6 --test_runs 7 8
#   python scripts/rom_train_mvar.py --experiment_name rom_test
#   python scripts/rom_evaluate.py --experiment_name rom_test --sim_root simulations/.../runs --no_videos

# Model configuration
model:
  name: social_force
  params:
    N: 50               # Small for fast testing (use 200+ for production)
    T: 300              # Short run (use 1000+ for production)
    dt: 0.1
    Lx: 10.0
    Ly: 10.0
    boundary: periodic
    alpha: 1.5          # D'Orsogna repulsion
    beta: 0.5           # D'Orsogna attraction
    Cr: 2.0
    Ca: 1.0
    lr: 0.9
    la: 1.0
    v0: 0.5
    noise: 0.1

# Initial conditions (varied across ensemble)
ic:
  type: uniform         # Default, overridden by ensemble

# Ensemble for ROM training
ensemble:
  n_runs: 10            # 10 runs for testing (use 20-50 for production)
  base_seed: 42
  ic_types:
    - uniform
    - gaussian
    - ring
    - cluster
  ic_weights: [0.4, 0.3, 0.2, 0.1]

# Density estimation
density:
  nx: 32                # Low resolution for speed (use 128 for production)
  ny: 32
  bandwidth: 0.5
  t_skip: 2             # Downsample time (use 1 for production)
  normalize: true

# Output settings
output:
  save_traj: true
  save_density: true    # REQUIRED for ROM pipeline
  save_metrics: true
  save_animation: false # Skip animations for ensemble

# ROM Pipeline Usage:
#
# After generating ensemble, the directory structure will be:
#   simulations/<model_id>/runs/run_XXXX/density.npz
#
# Then run ROM stages:
#   1. POD:      python scripts/rom_build_pod.py --experiment_name rom_test --sim_root ... --train_runs 0-7 --test_runs 8-9
#   2. MVAR:     python scripts/rom_train_mvar.py --experiment_name rom_test
#   3. Evaluate: python scripts/rom_evaluate.py --experiment_name rom_test --sim_root ... --no_videos
#
# Outputs will be in:
#   rom/rom_test/{pod, latent, mvar/forecast}
#
# Expected results:
#   - POD modes: ~10-20 modes for 99.5% energy
#   - Compression: ~50x (1024 grid points → ~20 latent dimensions)
#   - R²: 0.6-0.9 (depends on dynamics complexity)
#   - Runtime: ~2-5 minutes for full pipeline (local machine)
