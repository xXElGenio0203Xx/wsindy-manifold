---
# ============================================================================
# SUITE S0: Deterministic Advection Sanity Check — MVAR p=1, H≈37 steps
# ============================================================================
#
# GOAL: Pure translating blob on periodic domain. No alignment, no forces,
#       no noise → density field translates rigidly. A lag-1 MVAR should
#       capture this perfectly (R² ≈ 1.0).
#
# PHYSICS: All interactions DISABLED
#   - alignment: R=0.15 (so small no real neighbors, self-align only)
#   - forces: disabled
#   - noise: eta=0.0
#   - speed_mode: "constant" → every particle moves at v0=1.5 in its
#     initial heading direction, unchanged forever
#   - Periodic BC → blob wraps around, no reflections
#
# NOTE: Each run has random initial headings, so the "advection direction"
#       differs per run. But within each run the density field is a rigid
#       translation, which is perfectly linear in latent space.
#
# HORIZON: ~37 ROM forecast steps (same as V1 test)
#   T=5s, dt=0.04, subsample=3 → 42 ROM frames
#   forecast_start=0.12s (lag=1 ROM frame) → 42 - 1 = 41 forecast steps
#   (slightly more than 37, but close enough — same total T as V1)
#
# EXPECTED: R² ≈ 1.0 (or very close). If not, something is fundamentally
#           broken in the pipeline.
# ============================================================================

experiment_name: "suite_S0_det_advect_H37_mvar_p1"

# ============================================================================
# SIMULATION PARAMETERS
# ============================================================================
sim:
  N: 200
  T: 5.0                    # 5s → ~42 ROM frames with subsample=3
  dt: 0.04
  Lx: 15.0
  Ly: 15.0
  bc: "periodic"

model:
  type: "discrete"
  speed: 1.5
  speed_mode: "constant"     # No forces affect motion

# Alignment radius so tiny that each particle only sees itself
# → heading is preserved (no alignment)
# Check: v0*dt = 0.06 <= 0.5*0.15 = 0.075 ✓
params:
  R: 0.15

# ZERO noise → headings never change
noise:
  kind: "gaussian"
  eta: 0.0
  match_variance: true

# Forces DISABLED
forces:
  enabled: false

alignment:
  enabled: true              # must be true for backend, but R=0.15 → no real alignment

# ============================================================================
# DENSITY
# ============================================================================
density:
  nx: 48
  ny: 48
  bandwidth: 4.0

outputs:
  density_resolution: 48
  density_bandwidth: 4.0

# ============================================================================
# TRAINING: 50 runs — only gaussian blobs (simplest IC for sanity check)
# ============================================================================
train_ic:
  type: "mixed_comprehensive"

  gaussian:
    enabled: true
    n_runs: 50
    positions_x: [4.0, 7.5, 11.0]
    positions_y: [4.0, 7.5, 11.0]
    variances: [1.0, 2.0]
    n_samples_per_config: 3      # 3×3×2×3 = 54, will cap at 50

  uniform:
    enabled: false
  two_clusters:
    enabled: false
  ring:
    enabled: false

# ============================================================================
# TEST: 10 runs — gaussian blobs at different positions
# ============================================================================
test_ic:
  type: "mixed_test_comprehensive"

  gaussian:
    enabled: true
    n_runs: 10
    test_positions_x: [5.0, 10.0]
    test_positions_y: [5.0, 10.0]
    test_variances: [1.5]
    n_samples_per_config: 1      # 2×2×1 = 4, plus 6 extrapolation
    extrapolation_positions: [[3.0, 3.0], [12.0, 3.0], [3.0, 12.0], [12.0, 12.0], [7.5, 2.0], [2.0, 7.5]]
    extrapolation_variance: [1.5]

  uniform:
    enabled: false
  two_clusters:
    enabled: false
  ring:
    enabled: false

# ============================================================================
# ROM: MVAR p=1
# ============================================================================
rom:
  subsample: 3
  pod_energy: 0.90

  models:
    mvar:
      enabled: true
      lag: 1                   # LAG 1 — minimal for advection
      ridge_alpha: 1.0e-4

    lstm:
      enabled: false

# ============================================================================
# EVALUATION
# ============================================================================
eval:
  metrics: ["r2", "rmse"]
  save_forecasts: true
  save_time_resolved: true
  forecast_start: 0.12        # 1 ROM frame = lag * subsample * dt = 1*3*0.04
